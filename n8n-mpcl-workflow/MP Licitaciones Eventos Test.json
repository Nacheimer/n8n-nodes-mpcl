{
  "name": "MP Licitaciones Eventos Cordillera",
  "nodes": [
    {
      "parameters": {},
      "id": "manual-trigger",
      "name": "When clicking 'Execute workflow'",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1040,
        -128
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "companyName",
              "name": "companyName",
              "value": "Eventos Cordillera",
              "type": "string"
            },
            {
              "id": "companyEmail",
              "name": "companyEmail",
              "value": "contacto@eventoscordillera.cl",
              "type": "string"
            },
            {
              "id": "sector",
              "name": "sector",
              "value": "maquinaria_servicios",
              "type": "string"
            },
            {
              "id": "tags",
              "name": "tags",
              "value": "catering,banqueter√≠a,eventos,coffee break,almuerzos",
              "type": "string"
            },
            {
              "id": "ruburos",
              "name": "ruburos",
              "value": "90101600, 90101700",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "set-client-data",
      "name": "Set Client Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -896,
        -128
      ]
    },
    {
      "parameters": {
        "operation": "webSearch",
        "idOrden": 3,
        "rubros": "={{ $json.rubros }}"
      },
      "id": "search-tenders",
      "name": "Search Tenders",
      "type": "n8n-nodes-mpcl.mercadoPublico",
      "typeVersion": 1,
      "position": [
        -608,
        -128
      ],
      "retryOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// Format tender data for LLM analysis\\nconst items = $input.all();\\n\\nif (!items || items.length === 0) {\\n  return [{ json: { count: 0, tenders: [], markdown: '', hasData: false }}];\\n}\\n\\nconst formattedTenders = items.map((item, index) => {\\n  const t = item.json;\\n  let montoValue = 0;\\n  if (t.monto) {\\n    if (typeof t.monto === 'string') { montoValue = parseInt(t.monto.replace(/\\\\./g, ''), 10) || 0; }\\n    else { montoValue = t.monto; }\\n  }\\n  return {\\n    numero: index + 1,\\n    codigo: t.id || 'N/A',\\n    nombre: t.title || 'Sin t√≠tulo',\\n    descripcion: t.description || 'Sin descripci√≥n',\\n    monto_estimado: montoValue,\\n    fecha_publicacion: t.fechaPublicacion || 'N/A',\\n    fecha_cierre: t.fechaCierre || 'N/A',\\n    tipo: t.tipo || 'N/A',\\n    estado: t.estado || 'N/A',\\n    organismo: t.organismo || 'N/A',\\n    link: t.link || ''\\n  };\\n});\\n\\nconst markdown = formattedTenders.map(t => `\\n---\\nC√ìDIGO: ${t.codigo}\\nNOMBRE: ${t.nombre}\\nDESCRIPCI√ìN: ${t.descripcion.substring(0,400)}...\\n`).join('');\\n\\nreturn [{ json: { count: formattedTenders.length, tenders: formattedTenders, markdown, hasData: true }}];"
      },
      "id": "format-for-llm",
      "name": "Format Tenders for LLM",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -464,
        -128
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4-turbo",
          "mode": "list",
          "cachedResultName": "gpt-4-turbo"
        },
        "messages": {
          "values": [
            {
              "content": "Eres un experto en an√°lisis de licitaciones p√∫blicas. Tu tarea es identificar qu√© licitaciones son relevantes para un cliente bas√°ndote en sus palabras clave de inter√©s.\\n\\nüìã INSTRUCCIONES:\\n\\n1. ANALIZAR las palabras clave del cliente (pueden estar separadas por comas o espacios)\\n2. REVISAR cada licitaci√≥n en la lista buscando coincidencias en NOMBRE y DESCRIPCI√ìN\\n3. ACEPTAR coincidencias directas Y sem√°nticas:\\n   - Palabras exactas\\n   - Sin√≥nimos y t√©rminos relacionados del sector\\n   - Variaciones ortogr√°ficas\\n\\n4. Para CADA licitaci√≥n relevante:\\n   - COPIAR su c√≥digo EXACTAMENTE como aparece despu√©s de \\\"C√ìDIGO:\\\"\\n   - M√°ximo 10 licitaciones\\n\\n5. Si NO encuentras licitaciones relevantes ‚Üí devolver {\\\"matching_ids\\\": []}\\n\\n‚ö†Ô∏è IMPORTANTE: \\n- SOLO devuelve c√≥digos que aparezcan LITERALMENTE en la lista proporcionada\\n- NUNCA inventes c√≥digos nuevos\\n- Los c√≥digos tienen formato como \\\"2735-144-LR25\\\", \\\"425-90-LQ25\\\", etc.\\n- S√â INCLUSIVO: acepta sin√≥nimos, t√©rminos relacionados y variaciones del sector\\n\\nRESPUESTA (formato JSON):\\n{\\n  \\\"matching_ids\\\": [\\\"codigo-1\\\", \\\"codigo-2\\\", ...]\\n}",
              "role": "system"
            },
            {
              "content": "üìö SECTOR: SERVICIOS PARA EVENTOS Y CATERING\\n\\nSin√≥nimos clave:\\n- catering = banqueter√≠a = banquetes = colaciones = coffee break = alimentaci√≥n para eventos\\n- eventos = ceremonias = congresos = seminarios = reuniones corporativas\\n- log√≠stica de eventos = montaje = arriendo de menaje = garzones = producci√≥n de eventos\\n\\nT√©rminos aceptados:\\n- Servicios de alimentaci√≥n para eventos, coffee break, almuerzos, box lunch, cocteler√≠a, banqueter√≠a, men√∫s especiales, dietas\\n- Servicios asociados: arriendo de menaje, montaje, personal de servicio, transporte y distribuci√≥n de alimentos\\n\\nREGLAS:\\n- Considera coincidencias en nombre/descripcion que apunten a catering o servicios para eventos corporativos.",
              "role": "user"
            }
          ]
        }
      },
      "id": "llm-filter",
      "name": "LLM Filter",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 4,
      "position": [
        -320,
        -128
      ]
    }
  ],
  "pinData": {}
}